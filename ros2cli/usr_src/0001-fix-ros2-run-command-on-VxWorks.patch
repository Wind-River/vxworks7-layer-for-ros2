From b9ae16396efcd6958fb7f2cec9bdd2b7e4d4e5e9 Mon Sep 17 00:00:00 2001
From: Andrei Kholodnyi <andrei.kholodnyi@windriver.com>
Date: Sun, 4 Jun 2023 15:40:29 +0200
Subject: [PATCH] fix ros2 run command on VxWorks

---
 ros2run/ros2run/api/__init__.py | 13 +++++++++++++
 1 file changed, 13 insertions(+)

diff --git a/ros2run/ros2run/api/__init__.py b/ros2run/ros2run/api/__init__.py
index fd592bc..240d83f 100644
--- a/ros2run/ros2run/api/__init__.py
+++ b/ros2run/ros2run/api/__init__.py
@@ -16,6 +16,7 @@ import os
 import signal
 import subprocess
 import sys
+from elftools.elf.elffile import ELFFile
 
 from ros2pkg.api import get_executable_paths
 from ros2pkg.api import PackageNotFound
@@ -58,6 +59,18 @@ def run_executable(*, path, argv, prefix=None):
     if os.name == 'nt' and path.endswith('.py'):
         cmd.insert(0, sys.executable)
 
+    # on VxWorks Python scripts are invokable through the interpreter
+    if sys.platform == 'vxworks':
+        pyfmt = False
+        f = open(path, 'rb')
+        try:
+            elf = ELFFile(f)
+        except Exception as e:
+            pyfmt = True
+
+        if pyfmt:
+            cmd.insert(0, sys.executable)
+
     if prefix is not None:
         cmd = prefix + cmd
 
-- 
2.34.1

